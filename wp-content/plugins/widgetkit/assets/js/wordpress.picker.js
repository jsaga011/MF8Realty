"use strict";!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var d=t(jQuery);function l(n){var t=window.widgetkit.iframe;function e(t){var e=t.originalEvent.data;e.widget&&(window.tb_remove(),n(e.widget))}window.tb_show("",t),d.default("#TB_overlay").css("zIndex",9e5),d.default("#TB_window").css("zIndex",900001),o(),d.default(window).on("message",e),d.default(window).on("resize",o),d.default("body").one("thickbox:removed",function(){d.default(window).off("message",e),d.default(window).off("resize",o)})}function o(){var t=d.default("#TB_window"),e=d.default(window).width(),n=d.default(window).height(),o=1280<e?1280:e,i=d.default("#wpadminbar"),r=i.length?parseInt(i.css("height"),10):0;t.length&&(t.width(o-50).height(n-45-r),d.default("#TB_iframeContent").width(o-50).height(n-75-r),t.css({"margin-left":"-"+parseInt((o-50)/2,10)+"px"}),void 0!==document.body.style.maxWidth&&t.css({top:20+r+"px","margin-top":"0"}))}function c(t){var r=window.tinymce.editors[t.attr("id")];return{getContent:function(){return r.getContent()},insertContent:function(t){r.execCommand("mceInsertContent",!1,t)},updateContent:function(t,e,n){var o=this.getContent();o=o.substring(0,e)+t+'<span id="tmp-wkid"></span>'+o.substring(n),r.setContent(o),r.selection.select(r.dom.select("#tmp-wkid")[0],!0),r.selection.collapse(!1),r.dom.remove("tmp-wkid",!1),r.focus()},getCursorPosition:function(){var t=r.selection.getBookmark(0),e=r.dom.select("[data-mce-type=bookmark]");r.selection.select(e[0]),r.selection.collapse();var n="######cursor######",o='<span id="'+n+'"></span>';r.selection.setContent(o);var i=r.getContent({format:"html"}).indexOf(o);return r.dom.remove(n,!1),r.selection.moveToBookmark(t),i}}}function f(r){return{getContent:function(){return r.val()},insertContent:function(t){this.updateContent(t,r.prop("selectionStart"),r.prop("selectionEnd"))},updateContent:function(t,e,n){var o=r.val(),i=e+t.length;o=o.substring(0,e)+t+o.substring(n),r.val(o),r[0].setSelectionRange(i,i),r.focus().trigger("change")},getCursorPosition:function(){return r.prop("selectionStart")}}}function g(t){var o=t.next()[0].CodeMirror;return{getContent:function(){return o.getValue()},insertContent:function(t){o.replaceRange(t,o.getCursor()),o.focus()},updateContent:function(t,e,n){o.replaceRange(t,this.translateOffset(e),this.translateOffset(n)),o.focus()},getCursorPosition:function(){return this.translatePosition(o.getCursor())},translatePosition:function(t){return o.getValue().split("\n",t.line).join("").length+t.line+t.ch},translateOffset:function(t){var e=o.getValue().substring(0,t).split("\n");return{line:e.length-1,ch:e[e.length-1].length}}}}function w(t){var i=window.ace.edit(t.parent().attr("id"));return{getContent:function(){return i.getValue()},insertContent:function(t){i.insert(t),i.focus()},updateContent:function(t,e,n){e=this.translateOffset(e),n=this.translateOffset(n);var o=i.getSelectionRange();o.setStart(e.row,e.column),o.setEnd(n.row,n.column),i.getSession().getDocument().replace(o,t),i.focus()},getCursorPosition:function(){return this.translatePosition(i.getSelection().getCursor())},translatePosition:function(t){return this.getContent().split("\n",t.row).join("").length+t.row+t.column},translateOffset:function(t){var e=this.getContent().substring(0,t).split("\n");return{row:e.length-1,column:e[e.length-1].length}}}}function p(t){var i=window.CKEDITOR.instances[t.attr("id")];return{getContent:function(){return i.getData()},insertContent:function(t){this.updateContent(t,this.getCursorPosition(),this.getCursorPosition())},updateContent:function(t,e,n){var o=i.getData();o=o.substring(0,e)+t+o.substring(n),i.setData(o)},getCursorPosition:function(){return"source"===i.mode?d.default(i.textarea.$).prop("selectionStart"):this.getCursorPositionInWYSIWYG()},getCursorPositionInWYSIWYG:function(){var t=i.getSelection().createBookmarks(),e='<span id="######cursor######">&nbsp;</span>',n=window.CKEDITOR.dom.element.createFromHtml(e);n.insertBefore(t[0].startNode);var o=this.getContent().indexOf(e);return n.remove(),i.getSelection().selectBookmarks(t),o}}}function h(t){d.default.extend(this,{tag:"",attrs:{},type:"single",content:""},t)}var e;d.default.extend(h,{parse:function(t,e){var n,o=this.regexp(t).exec(e),i={tag:t};return o&&(n=o[4]?"self-closing":o[6]?"closed":"single",i={tag:o[2],attrs:this.attrs(o[3]),type:n,content:o[5]}),new h(i)},attrs:function(t){var e,n=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*'([^']*)'(?:\s|$)|(\w+)\s*=\s*([^\s'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/g,o={};for(t=t.replace(/[\u00a0\u200b]/g," ");e=n.exec(t);)e[1]?o[e[1].toLowerCase()]=e[2]:e[3]?o[e[3].toLowerCase()]=e[4]:!e[5]||"true"!==e[6]&&"1"!==e[6]?!e[5]||"false"!==e[6]&&"0"!==e[6]?e[5]?o[e[5].toLowerCase()]=e[6]:e[7]?o[e[7]]=!0:e[8]&&(o[e[8]]=!0):o[e[5].toLowerCase()]=!1:o[e[5].toLowerCase()]=!0;return o},regexp:function(t){return new RegExp("\\[(\\[?)("+t+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)","g")}}),d.default.extend(h.prototype,{string:function(){var n="["+this.tag;return d.default.each(this.attrs,function(t,e){"boolean"==typeof e?n+=" "+t+"="+(e?1:0):""!==e&&(n+=" "+t+'="'+e+'"')}),"single"===this.type?n+"]":"self-closing"===this.type?n+" /]":(n+="]",this.content&&(n+=this.content),n+"[/"+this.tag+"]")}}),d.default(document).on("click",".widgetkit-widget a",function(t){var e=this;t.preventDefault(),l(function(t){d.default(e).next("input").val(JSON.stringify(t)),d.default(e).text("Widget: "+t.name),d.default(e).closest("form").find('input[type="text"]').trigger("change")})}),d.default(document).on("click",".widgetkit-editor",function(t){t.preventDefault();for(var e,n,o,i=d.default("#"+d.default(this).data("source")),r=(e=i,new((window.WFEditor||window.JContentEditor||window.tinyMCE)&&!e.is(":visible")?c:window.CodeMirror&&e.next()[0]&&e.next()[0].CodeMirror?g:window.ace?w:window.CKEDITOR?p:f)(e)),s=r.getContent(),a=r.getCursorPosition(),u=/\[widgetkit([^\]]*)\]/gi;o=u.exec(s);)if(o.index<=a&&u.lastIndex>a){n=o[0];break}l(function(t){var e=new h({tag:"widgetkit",attrs:t}).string();n?r.updateContent(e,o.index,u.lastIndex):r.insertContent(e)})}),null!=(e=window.tinyMCE)&&e.on("AddEditor",function(t){var e,n,o,i=d.default(null==(e=t.editor)?void 0:e.formElement);if(i.length){var r=i[0]._button||i.find(".widgetkit-editor"),s=i.find(".wp-media-buttons");(i[0]._button=r).data("source",null==(n=t.editor)||null==(o=n.targetElm)?void 0:o.id),s.has(r).length||s.append(r)}})}();